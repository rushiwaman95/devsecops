apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-alerts
  namespace: monitoring
data:
  alert-rules.yaml: |
    groups:
      - name: pod-alerts
        rules:
          # Pod Restart Alert
          - alert: PodRestartingTooMuch
            expr: increase(kube_pod_container_status_restarts_total[1h]) > 3
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "Pod {{ $labels.pod }} restarting too much"
              description: "Pod has restarted more than 3 times in 1 hour"

          # Pod CrashLooping
          - alert: PodCrashLooping
            expr: rate(kube_pod_container_status_restarts_total[15m]) > 0
            for: 5m
            labels:
              severity: critical
            annotations:
              summary: "Pod {{ $labels.pod }} is crash looping"

      - name: cpu-alerts
        rules:
          # High CPU Usage
          - alert: HighCPUUsage
            expr: (sum(rate(container_cpu_usage_seconds_total[5m])) by (pod)) > 0.8
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "High CPU usage on pod {{ $labels.pod }}"
              description: "CPU usage is above 80%"

          # Critical CPU Usage
          - alert: CriticalCPUUsage
            expr: (sum(rate(container_cpu_usage_seconds_total[5m])) by (pod)) > 0.95
            for: 2m
            labels:
              severity: critical
            annotations:
              summary: "Critical CPU usage on pod {{ $labels.pod }}"
              description: "CPU usage is above 95%"

      - name: memory-alerts
        rules:
          # High Memory Usage
          - alert: HighMemoryUsage
            expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) > 0.8
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "High memory usage on pod {{ $labels.pod }}"
              description: "Memory usage is above 80%"